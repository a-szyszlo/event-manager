{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/wp-admin/",
  "preferredVersions": {
    "php": "8.0",
    "wp": "latest"
  },
  "features": {
    "networking": true
  },
  "steps": [
    {
      "step": "login",
      "username": "admin"
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "url",
        "url": "https://github.com/a-szyszlo/event-manager/archive/refs/heads/main.zip",
        "caption": "Pobieranie i instalacja event-manager"
      },
      "options": {
        "activate": true,
        "targetFolderName": "event-manager"
      }
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "wordpress.org/plugins",
        "slug": "advanced-custom-fields"
      },
      "options": {
        "activate": true
      }
    },
    {
      "step": "runPHP",
      "code": "<?php\ntry {\n// Seed cities (taxonomy: city) with error suppression to avoid fatal in Wasm\n$city_slugs = ['warszawa' => 'Warszawa', 'krakow' => 'Kraków', 'wroclaw' => 'Wrocław'];\nforeach ($city_slugs as $slug => $name) { if (!term_exists($slug, 'city')) { @wp_insert_term($name, 'city', ['slug' => $slug]); } }\n\nfunction em_seed_event($title, $date, $limit, $city_slug, $registrations = []) {\n    $post_id = wp_insert_post([\n        'post_type'   => 'event',\n        'post_status' => 'publish',\n        'post_title'  => $title,\n        'post_content'=> 'Opis testowy dla wydarzenia '. $title .'.',\n    ]);\n    if (is_wp_error($post_id) || !$post_id) { return 0; }\n    if ($city_slug) { @wp_set_post_terms($post_id, [$city_slug], 'city', false); }\n    if (function_exists('update_field')) {\n        @update_field('event_datetime', $date, $post_id);\n        if (!is_null($limit)) { @update_field('event_participant_limit', intval($limit), $post_id); }\n    } else {\n        @update_post_meta($post_id, 'event_datetime', $date);\n        if (!is_null($limit)) { @update_post_meta($post_id, 'event_participant_limit', intval($limit)); }\n    }\n    // Seed initial registrations meta if provided\n    if (!empty($registrations)) {\n        @update_post_meta($post_id, 'event_registrations', $registrations);\n    }\n    return $post_id;\n}\n\n$now = current_time('timestamp');\n$fmt = 'Y-m-d H:i:s';\n$event1_date = date($fmt, $now + 86400);\n$event2_date = date($fmt, $now + 3*86400);\n$event3_date = date($fmt, $now + 7*86400);\n\n$seed_reg_base = function($name,$email) { return ['name'=>$name,'email'=>strtolower(trim($email)),'registered_at'=>current_time('mysql'),'user_ip'=>'127.0.0.1']; };\n$event1_regs = [ $seed_reg_base('Jan Demo','jan.demo@example.com') ];\n$event2_regs = [ $seed_reg_base('Anna Test','anna.test@example.com'), $seed_reg_base('Piotr Example','piotr.example@example.com') ]; // almost full (limit 2) intentionally full\n$event3_regs = [];\n\n$e1 = em_seed_event('Warsztaty WP – Warszawa', $event1_date, 3, 'warszawa', $event1_regs);\n$e2 = em_seed_event('Meetup Dev – Kraków', $event2_date, 2, 'krakow', $event2_regs);\n$e3 = em_seed_event('Konferencja IT – Wrocław', $event3_date, null, 'wroclaw', $event3_regs);\n\n// Events page with shortcode\n$existing = get_page_by_path('eventy');\nif (!$existing) {\n    @wp_insert_post([\n        'post_title'   => 'Wydarzenia',\n        'post_name'    => 'eventy',\n        'post_status'  => 'publish',\n        'post_type'    => 'page',\n        'post_content' => '[event_search]',\n    ]);\n}\n} catch (Throwable $t) { /* swallow to avoid Wasm crash */ }\n"
    }
  ]
}