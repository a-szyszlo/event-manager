{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/wp-admin/",
  "preferredVersions": {
    "php": "8.0",
    "wp": "latest"
  },
  "features": {
    "networking": true
  },
  "steps": [
    {
      "step": "login",
      "username": "admin"
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "url",
        "url": "https://github.com/a-szyszlo/event-manager/archive/refs/heads/main.zip",
        "caption": "Pobieranie i instalacja event-manager"
      },
      "options": {
        "activate": true,
        "targetFolderName": "event-manager"
      }
    },
    {
      "step": "installPlugin",
      "pluginData": {
        "resource": "wordpress.org/plugins",
        "slug": "advanced-custom-fields"
      },
      "options": {
        "activate": true
      }
    },
    {
      "step": "runPHP",
      "code": "<?php\n// Seed cities (taxonomy: city)\n$city_slugs = ['warszawa' => 'Warszawa', 'krakow' => 'Kraków', 'wroclaw' => 'Wrocław'];\nforeach ($city_slugs as $slug => $name) { if (!term_exists($slug, 'city')) { wp_insert_term($name, 'city', ['slug' => $slug]); } }\n\n// Helper to create an event with ACF fields and assign city\nfunction em_seed_event($title, $date, $limit, $city_slug) {\n    $post_id = wp_insert_post([\n        'post_type'   => 'event',\n        'post_status' => 'publish',\n        'post_title'  => $title,\n        'post_content'=> 'Opis testowy dla wydarzenia '. $title .'.',\n    ]);\n    if (is_wp_error($post_id) || !$post_id) { return; }\n    // Assign city term\n    if ($city_slug) { wp_set_post_terms($post_id, [$city_slug], 'city', false); }\n    // Set ACF fields (if available) or fallback to post meta\n    if (function_exists('update_field')) {\n        update_field('event_datetime', $date, $post_id);\n        if (!is_null($limit)) { update_field('event_participant_limit', intval($limit), $post_id); }\n    } else {\n        update_post_meta($post_id, 'event_datetime', $date);\n        if (!is_null($limit)) { update_post_meta($post_id, 'event_participant_limit', intval($limit)); }\n    }\n}\n\n$now = current_time('timestamp');\n$fmt = 'Y-m-d H:i:s';\n// Future dates for demo\n$event1_date = date($fmt, $now + 86400);       // +1 dzień\n$event2_date = date($fmt, $now + 3*86400);     // +3 dni\n$event3_date = date($fmt, $now + 7*86400);     // +7 dni\n\n// Create three demo events\nem_seed_event('Warsztaty WP – Warszawa', $event1_date, 3, 'warszawa');\nem_seed_event('Meetup Dev – Kraków', $event2_date, 2, 'krakow');\nem_seed_event('Konferencja IT – Wrocław', $event3_date, null, 'wroclaw');\n\n// Create a page with the [event_search] shortcode if not exists\n$existing = get_page_by_path('eventy');\nif (!$existing) {\n    $page_id = wp_insert_post([\n        'post_title'   => 'Wydarzenia',\n        'post_name'    => 'eventy',\n        'post_status'  => 'publish',\n        'post_type'    => 'page',\n        'post_content' => '[event_search]',\n    ]);\n}\n"
    }
  ]
}